<head>
	<style>
		body {
			background: #f4f4f4;
		}
		.archive-settings {
			position: absolute;
			top: 0;
			left: 0;
			padding-top: 10px;
			padding-left:10px;
			height: 40px;
			border-bottom: 1px solid grey;
			width: 100%;
			background: #3333cc;
			color: white;
		}
		.control-label {
			font-size: 12px;
		}
		.content {
			margin-right: 20px;
			float: left;
			border-radius: 0;
			border: none;
			width: 225px;
			height: 150px;
			font-size: 12px !important;
			margin-bottom: 20px;
			overflow: hidden;
			padding: 0;
			float: left;
			background: white;
			color: black;
		}
		.main {
			margin: 0;
			width: 101%;
		}
		.post {
			font-size: 12px;
		}
		.date-overlay {
			display: none;
			z-index: 1;
			text-align: center;
			width: 100%;
			height: 100%;
			position: absolute;
			top: 0;
			left:0;
			background-color: rgb(0,0,0);
			background-color: rgba(0,0,0,0.4);
			color: white;
		}
		.date-overlay-date {
			margin-top: 40px;
			color: white;
			font-size: 14px;
		}
		.content img {
			position: absolute;
			top: 0;
			left: 0;
		}
		.content a {
			color: black;
			text-decoration: none;
		}
	</style>
</head>
<body>
	<div class="archive-settings">
		<%= getSelectBoxes(@first_post_date, @last_post_date) %>
	</div>

	<div class="main">
		<%= render partial: 'archive_posts' %>
	</div>
	<script src="/js/masonry.pkgd.min.js"></script>
	<script>

		var months = [
			'January',
			'February',
			'March',
			'April',
			'May',
			'June',
			'July',
			'August',
			'September',
			'October',
			'November',
			'December'
		];


		$(function() {
			$(".archive-year-select").change(function() {
				console.log('the year changed');

				var selected_year = $(".archive-year-select").val();
				var html = '';

				if (selected_year == <%= @first_post_date.year %>) {
					for (var i = <%= @first_post_date.month-1 %>; i < months.length; i++) {
						html += getOptionHtml(months[i]);
					}
				}
				else if (selected_year == <%= @last_post_date.year %>) {
					for (var i = 0; i < <%= @last_post_date.month %>; i++) {
						html += getOptionHtml(months[i]);
					}
				}
				else {
					for (var i =0; i < months.length; i++) {
						html += getOptionHtml(months[i]);
					}
				}

				$('.archive-month-select').html(html);
			});

			$(".archive-month-select").change(function() {
				console.log('the month changed');
				$.get(
					'/users/<%= @user.id %>/fetchArchivePosts', 
					{ month: $(".archive-month-select").val(), year: $(".archive-year-select").val()},
					function(data) {
						if (data != 'false') {
							$('.main').masonry('remove', $('.content')).masonry('layout');
							var posts = $('<div>').append(data).find('.content');
							console.log(posts);
							$('.main').append(posts).masonry('appended', posts);

							bind_hover();
						}

					}
				)
			});

			console.log('test');
			masonry_init();

			bind_hover();


		});

		function masonry_init() {
			$('.main').masonry({
				itemSelector: '.content',
				columnWidth: 250
			})
		}

		function bind_hover() {
			$('.content').hover(function() {
				$(this).children(':first').children(':first').show();
			}, function() {
				$(this).children(':first').children(':first').hide()
			})
		}

		function getOptionHtml(option) {
			return '<option value="' + option + '">' + option + "</option>"
		}

	</script>
	<div class="navigation-content">
	    <ul class="nav-buttons">
	        <% if session[:userid] %>
	            <li id="Logout"><a href="/users/logout"><i class="fa fa-sign-out"></i>Logout</a></li>
	            <li id="Dashboard"><a href="<%= user_dashboard_path %>"><i class="fa fa-tachometer"></i>Dashboard</a></li>
	        <% end %>
	        
	    </ul>
	</div>
</body>